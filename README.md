# Отчет по MyThreadPoolExecutor
## Введение
Кастомный пул потоков MyThreadPoolExecutor разработан для выполнения задач в многопоточной среде с использованием 
индивидуальных очередей для каждого рабочего потока (Worker). Этот отчет анализирует производительность пула и описывает механизм распределения задач, 
сравнивая его со стандартными решениями, такими как ThreadPoolExecutor из Java и пулы потоков в Apache Tomcat.
## Анализ производительности
Произведен анализ производительности пула, исследуется оптимальные значения параметров (queueSize, corePoolSize, maxPoolSize) на основе тестов с 200 задачами, 
каждая из которых имитирует 100 мс работы, и описывает механизм распределения задач. Сравнение проводится со стандартным ThreadPoolExecutor из Java.
### Сравнение с ThreadPoolExecutor
Тесты проводились с параметрами: corePoolSize=4, maxPoolSize=8, queueSize=10, keepAliveTime=10 секунд, 200 задач, каждая длительностью 100 мс, без задержки между отправками.

|Метрика|MyThreadPoolExecutor|ThreadPoolExecutor|
|----------|---------------------|----------------|
|Общее время (мс)|1320|324|
|Выполнено задач|88|18|
|Отклонено задач|112|182|
|Среднее время на задачу (мс)|15.0|18.0|

- MyThreadPoolExecutor
  - Выполнил больше задач (88 vs 18), что указывает на лучшую способность обрабатывать нагрузку.
  - Общее время выполнения выше (1320 мс vs 324 мс) из-за накладных расходов на управление несколькими очередями.
  - Среднее время на задачу ниже (15.0 мс vs 18 мс)
- ThreadPoolExecutor
  - Завершил меньше задач (18 vs 88), но быстрее (324 мс vs 1320 мс) благодаря одной общей очереди.
  - Высокий процент отклоненных задач (182 vs 146) указывает на ограничения при высокой интенсивности.
### Вывод: 
Кастомный пул лучше справляется с высокой нагрузкой, выполняя больше задач, но за счет увеличенного времени обработки. 
Для I/O-bound задач он предпочтительнее, тогда как для CPU-bound задач стандартный пул может быть эффективнее.
### Сравнение с аналогами (Tomcat, Jetty)
Пулы потоков в Apache Tomcat и Jetty оптимизированы для веб-приложений, поддерживая асинхронные операции (NIO, APR) 
и динамическое управление потоками. Кастомный пул менее специализирован, но более универсален для общих задач, таких как 
вычисления или I/O-bound операции. Для веб-приложений Tomcat и Jetty, вероятно, превосходят кастомный пул, но для 
специфических сценариев с высокой конкуренцией за очередь MyThreadPoolExecutor может быть конкурентоспособным.
## Мини-исследование оптимальных параметров
Тесты проводились с 200 задачами, каждая длительностью 100 мс, без задержки между отправками, с параметром keepAliveTime=10 секунд. 
Использовались следующие параметры:
### Влияние queueSize
|queueSize|	Общее время (мс)|	Выполнено|	Отклонено|	Среднее время на задачу (мс)|
|----------|----------------|----------|-----------|------------------------------|
|2|	435|	24|	176|	18.125|
|10|	1306|	88|	112|	14.8409|
|25|	2820|	114|	86|	24.7368|
|35|	3833|	139|	61|	27.5755|
|50|	5339|	199|	1|	26.8291|
- Наблюдения
  - Маленькие значения queueSize (2, 10) приводят к высокому числу отклоненных задач из-за ограниченной емкости очередей.
  - Увеличение queueSize (25, 35, 50) позволяет выполнить больше задач, но увеличивает общее время выполнения.
### Влияние corePoolSize
|corePoolSize|	Общее время (мс)|	Выполнено|	Отклонено|	Среднее время на задачу (мс)|
|----------|----------------|----------|-----------|------------------------------|
|2|	1303|	69|	131|	18.18.8841|
|3|	1301|	88|	112|	14.7841|
|4|	1197|	44|	156|	27.2045|
- Наблюдения
  - corePoolSize=3 показывает наилучшие результаты: больше выполненных задач (88) и низкое среднее время на задачу (14.7841 мс).
  - corePoolSize=2 и 4 имеют больше отклонений и выше среднее время на задачу.
### Влияние maxPoolSize
|maxPoolSize|	Общее время (мс)|	Выполнено|	Отклонено|	Среднее время на задачу (мс)|
|----------|----------------|----------|-----------|------------------------------|
|6|	1303|	64|	136|	20.3594|
|7|	1248|	35|	165|	35.6571|
|8|	1270|	54|	146|	23.5185|
- Наблюдения
  - maxPoolSize=6 позволяет выполнить больше задач (64) с умеренным средним временем на задачу (20.3594 мс).
  - Увеличение до 7 и 8 ухудшает производительность, вероятно, из-за конкуренции за ресурсы CPU.
## Принцип распределения задач и балансировки
Кастомный пул MyThreadPoolExecutor использует индивидуальные очереди для каждого воркера (CustomBlockingQueue), 
в отличие от одной общей очереди в ThreadPoolExecutor. Распределение задач осуществляется через метод chooseWorker, который:
- Выбирает неактивного воркера (!isActive), если такой есть, для немедленного выполнения задачи.
- Если все воркеры активны, выбирает воркера с наименьшим количеством задач в очереди (стратегия "Least Loaded").

**Преимущества:**
- Снижение конкуренции за доступ к очереди, так как каждый воркер работает со своей собственной очередью.
- Улучшенная балансировка нагрузки за счет выбора наименее загруженного воркера.

**Недостатки:**
- Увеличение сложности управления из-за необходимости синхронизации доступа к списку воркеров.
- Накладные расходы на выбор наименее загруженного воркера.
Этот подход эффективен для задач с высокой интенсивностью или разной продолжительностью, минимизируя время ожидания задач.

## Заключение и рекомендации
Кастомный пул MyThreadPoolExecutor превосходит стандартный ThreadPoolExecutor по количеству выполненных задач (88 vs 18) в условиях высокой нагрузки, 
но требует больше времени на обработку (1320 мс vs 324 мс). Оптимальные параметры:

- queueSize=25-50 для баланса между выполнением задач и временем обработки.
- corePoolSize=3 для максимальной производительности.
- maxPoolSize=6 для эффективного использования ресурсов.
